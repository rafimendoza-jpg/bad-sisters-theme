{%- comment -%}
  Section: Staggered Gallery ‚Äî Galer√≠a con aparici√≥n escalonada
  Im√°genes en grid que aparecen una por una con efecto fade + slide up
  al hacer scroll. Timing escalonado da un efecto muy sofisticado.
{%- endcomment -%}

<style>
  #STG-{{ section.id }} {
    {%- if section.settings.background_color != blank and section.settings.background_color != 'rgba(0,0,0,0)' -%}
      background-color: {{ section.settings.background_color }};
    {%- endif -%}
    overflow: hidden;
  }

  #STG-{{ section.id }} .stg__header { text-align: center; margin-bottom: 3rem; }
  #STG-{{ section.id }} .stg__sub {
    font-size: 0.75rem; letter-spacing: 0.2em; text-transform: uppercase;
    color: var(--color-text-light); margin: 0 0 0.5rem;
  }
  #STG-{{ section.id }} .stg__title {
    font-size: clamp(1.5rem, 3vw, 2.5rem); font-weight: 300;
    letter-spacing: 0.1em; text-transform: uppercase; margin: 0;
  }

  /* Grid */
  #STG-{{ section.id }} .stg__grid {
    display: grid;
    grid-template-columns: repeat({{ section.settings.columns }}, 1fr);
    gap: {{ section.settings.gap }}px;
  }

  /* Item */
  #STG-{{ section.id }} .stg__item {
    position: relative;
    overflow: hidden;
    border-radius: {{ section.settings.border_radius }}px;
    /* Animation initial state */
    opacity: 0;
    transform: translateY({{ section.settings.slide_distance }}px);
    transition:
      opacity {{ section.settings.animation_duration }}ms cubic-bezier(0.25, 0.46, 0.45, 0.94),
      transform {{ section.settings.animation_duration }}ms cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }
  #STG-{{ section.id }} .stg__item.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Image */
  #STG-{{ section.id }} .stg__media {
    {%- if section.settings.image_ratio != 'auto' -%}
      aspect-ratio: {{ section.settings.image_ratio }};
    {%- endif -%}
    overflow: hidden;
  }
  #STG-{{ section.id }} .stg__img {
    width: 100%; height: 100%; object-fit: cover; display: block;
    transition: transform 0.7s ease;
  }
  #STG-{{ section.id }} .stg__item:hover .stg__img {
    transform: scale(1.05);
  }

  /* Caption overlay */
  #STG-{{ section.id }} .stg__caption {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    padding: 1.5rem;
    background: linear-gradient(0deg, rgba(0,0,0,0.5) 0%, transparent 50%);
    opacity: 0;
    transition: opacity 0.4s ease;
    color: #fff;
  }
  {%- if section.settings.caption_style == 'always' -%}
    #STG-{{ section.id }} .stg__caption { opacity: 1; }
  {%- else -%}
    #STG-{{ section.id }} .stg__item:hover .stg__caption { opacity: 1; }
  {%- endif -%}

  #STG-{{ section.id }} .stg__caption-title {
    font-size: 1rem; font-weight: 400; letter-spacing: 0.08em;
    text-transform: uppercase; margin: 0 0 0.25rem;
  }
  #STG-{{ section.id }} .stg__caption-sub {
    font-size: 0.8rem; opacity: 0.8; margin: 0;
  }

  /* Span classes for layout variety */
  #STG-{{ section.id }} .stg__item--wide { grid-column: span 2; }
  #STG-{{ section.id }} .stg__item--tall { grid-row: span 2; }

  /* Responsive */
  @media (max-width: 768px) {
    #STG-{{ section.id }} .stg__grid {
      grid-template-columns: repeat(2, 1fr) !important;
    }
    #STG-{{ section.id }} .stg__item--wide { grid-column: span 2; }
    #STG-{{ section.id }} .stg__item--tall { grid-row: span 1; }
    #STG-{{ section.id }} .stg__item {
      transform: translateY(30px);
    }
  }
  @media (max-width: 480px) {
    #STG-{{ section.id }} .stg__grid {
      grid-template-columns: 1fr !important;
    }
    #STG-{{ section.id }} .stg__item--wide { grid-column: span 1; }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    #STG-{{ section.id }} .stg__item {
      opacity: 1 !important;
      transform: none !important;
      transition: none !important;
    }
  }
</style>

<section id="STG-{{ section.id }}" class="stg section-padding" data-section-id="{{ section.id }}">
  <div class="{% if section.settings.full_width %}stg--full{% else %}page-width{% endif %}">

    {%- if section.settings.heading != blank or section.settings.subheading != blank -%}
      <div class="stg__header"{% if section.settings.text_color != blank %} style="color: {{ section.settings.text_color }};"{% endif %}>
        {%- if section.settings.subheading != blank -%}
          <p class="stg__sub">{{ section.settings.subheading }}</p>
        {%- endif -%}
        {%- if section.settings.heading != blank -%}
          <h2 class="stg__title">{{ section.settings.heading }}</h2>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="stg__grid">
      {%- for block in section.blocks -%}
        <div class="stg__item{% if block.settings.span_wide %} stg__item--wide{% endif %}{% if block.settings.span_tall %} stg__item--tall{% endif %}"
          data-stg-item
          data-stg-delay="{{ forloop.index0 | times: section.settings.stagger_delay }}"
          {{ block.shopify_attributes }}>

          {%- if block.settings.link != blank -%}<a href="{{ block.settings.link }}" class="stg__link" style="display:block;text-decoration:none;color:inherit;height:100%;">{%- endif -%}

          <div class="stg__media">
            {%- if block.settings.image != blank -%}
              <img
                src="{{ block.settings.image | image_url: width: 1200 }}"
                srcset="{{ block.settings.image | image_url: width: 400 }} 400w, {{ block.settings.image | image_url: width: 700 }} 700w, {{ block.settings.image | image_url: width: 1200 }} 1200w"
                sizes="(max-width: 480px) 100vw, (max-width: 768px) 50vw, {{ 100 | divided_by: section.settings.columns }}vw"
                alt="{{ block.settings.caption | default: block.settings.image.alt | default: 'Imagen' }}"
                loading="lazy" decoding="async"
                width="{{ block.settings.image.width }}"
                height="{{ block.settings.image.height }}"
                class="stg__img"
              >
            {%- else -%}
              <div style="aspect-ratio:3/4;background:#f0ebe5;display:flex;align-items:center;justify-content:center;">
                {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
              </div>
            {%- endif -%}
          </div>

          {%- if block.settings.caption != blank or block.settings.subtitle != blank -%}
            <div class="stg__caption">
              {%- if block.settings.caption != blank -%}
                <h3 class="stg__caption-title">{{ block.settings.caption }}</h3>
              {%- endif -%}
              {%- if block.settings.subtitle != blank -%}
                <p class="stg__caption-sub">{{ block.settings.subtitle }}</p>
              {%- endif -%}
            </div>
          {%- endif -%}

          {%- if block.settings.link != blank -%}</a>{%- endif -%}
        </div>
      {%- endfor -%}
    </div>

  </div>
</section>

<script>
  (function() {
    const section = document.getElementById('STG-{{ section.id }}');
    if (!section) return;
    const items = section.querySelectorAll('[data-stg-item]');
    if (!items.length) return;

    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      items.forEach(item => item.classList.add('is-visible'));
      return;
    }

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const delay = parseInt(entry.target.dataset.stgDelay) || 0;
          setTimeout(() => {
            entry.target.classList.add('is-visible');
          }, delay);
          observer.unobserve(entry.target);
        }
      });
    }, {
      threshold: 0.1,
      rootMargin: '0px 0px -30px 0px'
    });

    items.forEach(item => observer.observe(item));
  })();
</script>

{% schema %}
{
  "name": "Galer√≠a animada",
  "settings": [
    {
      "type": "text",
      "id": "subheading",
      "label": "Subt√≠tulo"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "T√≠tulo"
    },
    {
      "type": "header",
      "content": "üìê Grid"
    },
    {
      "type": "range",
      "id": "columns",
      "min": 2,
      "max": 5,
      "step": 1,
      "label": "Columnas",
      "default": 3
    },
    {
      "type": "range",
      "id": "gap",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Espacio entre im√°genes",
      "default": 8
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Proporci√≥n de im√°genes",
      "options": [
        { "value": "auto", "label": "Autom√°tica" },
        { "value": "1/1", "label": "Cuadrada (1:1)" },
        { "value": "3/4", "label": "Vertical (3:4)" },
        { "value": "4/5", "label": "Instagram (4:5)" },
        { "value": "4/3", "label": "Horizontal (4:3)" }
      ],
      "default": "3/4"
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Redondeo",
      "default": 0
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Ancho completo",
      "default": false
    },
    {
      "type": "header",
      "content": "üé¨ Animaci√≥n"
    },
    {
      "type": "range",
      "id": "animation_duration",
      "min": 400,
      "max": 1200,
      "step": 100,
      "unit": "ms",
      "label": "Duraci√≥n",
      "default": 700
    },
    {
      "type": "range",
      "id": "stagger_delay",
      "min": 50,
      "max": 300,
      "step": 25,
      "unit": "ms",
      "label": "Retraso entre im√°genes",
      "default": 100,
      "info": "Cada imagen aparece este tiempo despu√©s de la anterior"
    },
    {
      "type": "range",
      "id": "slide_distance",
      "min": 20,
      "max": 80,
      "step": 10,
      "unit": "px",
      "label": "Distancia del deslizamiento",
      "default": 50
    },
    {
      "type": "header",
      "content": "‚úçÔ∏è Captions"
    },
    {
      "type": "select",
      "id": "caption_style",
      "label": "Visibilidad de captions",
      "options": [
        { "value": "hover", "label": "Solo al pasar el mouse" },
        { "value": "always", "label": "Siempre visible" }
      ],
      "default": "hover"
    },
    {
      "type": "header",
      "content": "üé® Colores"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Color de fondo"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Color del texto"
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Imagen",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Imagen"
        },
        {
          "type": "text",
          "id": "caption",
          "label": "T√≠tulo"
        },
        {
          "type": "text",
          "id": "subtitle",
          "label": "Subt√≠tulo"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Enlace"
        },
        {
          "type": "checkbox",
          "id": "span_wide",
          "label": "Doble ancho",
          "default": false,
          "info": "Ocupa 2 columnas"
        },
        {
          "type": "checkbox",
          "id": "span_tall",
          "label": "Doble alto",
          "default": false,
          "info": "Ocupa 2 filas"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Galer√≠a animada",
      "settings": {
        "columns": 3,
        "gap": 8,
        "stagger_delay": 100
      },
      "blocks": [
        { "type": "image" },
        { "type": "image" },
        { "type": "image" },
        { "type": "image" },
        { "type": "image" },
        { "type": "image" }
      ]
    }
  ]
}
{% endschema %}
