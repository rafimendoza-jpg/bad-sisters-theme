{%- comment -%}
  Section: Scroll Reveal ‚Äî Bloques que se revelan con animaci√≥n al hacer scroll
  Imagen + texto se deslizan desde lados opuestos, con efecto "meeting in the middle".
  Soporta: alternating, slide-left, slide-right, fade-up
{%- endcomment -%}

<style>
  #SRV-{{ section.id }} {
    {%- if section.settings.background_color != blank and section.settings.background_color != 'rgba(0,0,0,0)' -%}
      background-color: {{ section.settings.background_color }};
    {%- endif -%}
    overflow: hidden;
  }
  #SRV-{{ section.id }} .srv__header { text-align: center; margin-bottom: 3rem; }
  #SRV-{{ section.id }} .srv__sub {
    font-size: 0.75rem; letter-spacing: 0.2em; text-transform: uppercase;
    color: var(--color-text-light); margin: 0 0 0.5rem;
  }
  #SRV-{{ section.id }} .srv__title {
    font-size: clamp(1.5rem, 3vw, 2.5rem); font-weight: 300;
    letter-spacing: 0.1em; text-transform: uppercase; margin: 0;
  }

  /* Block layout */
  #SRV-{{ section.id }} .srv__block {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: {{ section.settings.gap }}px;
    align-items: center;
    margin-bottom: {{ section.settings.block_spacing }}px;
  }
  #SRV-{{ section.id }} .srv__block:last-child { margin-bottom: 0; }

  /* Reverse layout for alternating */
  #SRV-{{ section.id }} .srv__block--reverse { direction: rtl; }
  #SRV-{{ section.id }} .srv__block--reverse > * { direction: ltr; }

  /* Media */
  #SRV-{{ section.id }} .srv__media {
    overflow: hidden;
    border-radius: {{ section.settings.border_radius }}px;
  }
  #SRV-{{ section.id }} .srv__img {
    width: 100%; height: 100%; object-fit: cover; display: block;
    transition: transform 0.8s ease;
  }
  #SRV-{{ section.id }} .srv__block:hover .srv__img { transform: scale(1.03); }

  /* Content */
  #SRV-{{ section.id }} .srv__content {
    padding: 2rem;
  }
  #SRV-{{ section.id }} .srv__heading {
    font-size: clamp(1.2rem, 2.5vw, 2rem); font-weight: 300;
    letter-spacing: 0.08em; text-transform: uppercase; margin: 0 0 1rem;
  }
  #SRV-{{ section.id }} .srv__text {
    font-size: 0.95rem; line-height: 1.7; margin: 0 0 1.5rem;
    color: var(--color-text-light);
  }
  #SRV-{{ section.id }} .srv__cta {
    display: inline-block; padding: 0.75rem 2rem; border: 1px solid currentColor;
    text-decoration: none; color: inherit; font-size: 0.75rem;
    letter-spacing: 0.15em; text-transform: uppercase;
    transition: background 0.3s, color 0.3s;
  }
  #SRV-{{ section.id }} .srv__cta:hover { background: #1a1a1a; color: #fff; }

  /* ---- ANIMATION STATES ---- */
  /* Initial hidden states */
  #SRV-{{ section.id }} .srv__media,
  #SRV-{{ section.id }} .srv__content {
    opacity: 0;
    transition: opacity {{ section.settings.animation_duration }}ms cubic-bezier(0.25, 0.46, 0.45, 0.94),
                transform {{ section.settings.animation_duration }}ms cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }
  /* Slide from left */
  #SRV-{{ section.id }} .srv__block--left .srv__media { transform: translateX(-80px); }
  #SRV-{{ section.id }} .srv__block--left .srv__content { transform: translateX(80px); transition-delay: 150ms; }
  /* Slide from right */
  #SRV-{{ section.id }} .srv__block--right .srv__media { transform: translateX(80px); }
  #SRV-{{ section.id }} .srv__block--right .srv__content { transform: translateX(-80px); transition-delay: 150ms; }
  /* Fade up */
  #SRV-{{ section.id }} .srv__block--fade-up .srv__media { transform: translateY(50px); }
  #SRV-{{ section.id }} .srv__block--fade-up .srv__content { transform: translateY(50px); transition-delay: 200ms; }

  /* Visible state */
  #SRV-{{ section.id }} .srv__block.is-visible .srv__media,
  #SRV-{{ section.id }} .srv__block.is-visible .srv__content {
    opacity: 1;
    transform: translate(0, 0);
  }

  /* Responsive */
  @media (max-width: 768px) {
    #SRV-{{ section.id }} .srv__block {
      grid-template-columns: 1fr !important;
    }
    #SRV-{{ section.id }} .srv__block--reverse { direction: ltr; }
    #SRV-{{ section.id }} .srv__media,
    #SRV-{{ section.id }} .srv__content {
      transform: translateY(40px) !important;
    }
    #SRV-{{ section.id }} .srv__content { padding: 1.5rem 0; }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    #SRV-{{ section.id }} .srv__media,
    #SRV-{{ section.id }} .srv__content {
      opacity: 1 !important;
      transform: none !important;
      transition: none !important;
    }
  }
</style>

<section id="SRV-{{ section.id }}" class="srv section-padding" data-section-id="{{ section.id }}">
  <div class="{% if section.settings.full_width %}srv--full{% else %}page-width{% endif %}">

    {%- if section.settings.heading != blank or section.settings.subheading != blank -%}
      <div class="srv__header"{% if section.settings.text_color != blank %} style="color: {{ section.settings.text_color }};"{% endif %}>
        {%- if section.settings.subheading != blank -%}
          <p class="srv__sub">{{ section.settings.subheading }}</p>
        {%- endif -%}
        {%- if section.settings.heading != blank -%}
          <h2 class="srv__title">{{ section.settings.heading }}</h2>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="srv__blocks">
      {%- for block in section.blocks -%}
        {%- assign anim = section.settings.animation_style -%}
        {%- if anim == 'alternating' -%}
          {%- assign mod = forloop.index0 | modulo: 2 -%}
          {%- if mod == 0 -%}
            {%- assign direction = 'left' -%}
            {%- assign reversed = false -%}
          {%- else -%}
            {%- assign direction = 'right' -%}
            {%- assign reversed = true -%}
          {%- endif -%}
        {%- elsif anim == 'slide-right' -%}
          {%- assign direction = 'right' -%}
          {%- assign reversed = true -%}
        {%- elsif anim == 'fade-up' -%}
          {%- assign direction = 'fade-up' -%}
          {%- assign reversed = false -%}
        {%- else -%}
          {%- assign direction = 'left' -%}
          {%- assign reversed = false -%}
        {%- endif -%}

        <div class="srv__block srv__block--{{ direction }}{% if reversed %} srv__block--reverse{% endif %}"
          data-srv-animate
          {{ block.shopify_attributes }}>

          <div class="srv__media">
            {%- if block.settings.image != blank -%}
              <img
                src="{{ block.settings.image | image_url: width: 1200 }}"
                srcset="{{ block.settings.image | image_url: width: 500 }} 500w, {{ block.settings.image | image_url: width: 800 }} 800w, {{ block.settings.image | image_url: width: 1200 }} 1200w"
                sizes="(max-width: 768px) 100vw, 50vw"
                alt="{{ block.settings.heading | default: block.settings.image.alt | default: 'Imagen' }}"
                loading="lazy"
                decoding="async"
                width="{{ block.settings.image.width }}"
                height="{{ block.settings.image.height }}"
                class="srv__img"
                {%- if block.settings.image_height != 'auto' %}
                  style="aspect-ratio: {{ block.settings.image_height }};"
                {%- endif %}
              >
            {%- else -%}
              <div style="aspect-ratio:4/5;background:#f0ebe5;display:flex;align-items:center;justify-content:center;">
                {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
              </div>
            {%- endif -%}
          </div>

          <div class="srv__content"{% if section.settings.text_color != blank %} style="color: {{ section.settings.text_color }};"{% endif %}>
            {%- if block.settings.heading != blank -%}
              <h3 class="srv__heading">{{ block.settings.heading }}</h3>
            {%- endif -%}
            {%- if block.settings.text != blank -%}
              <div class="srv__text rte">{{ block.settings.text }}</div>
            {%- endif -%}
            {%- if block.settings.button_label != blank -%}
              <a href="{{ block.settings.button_link | default: '#' }}" class="srv__cta">{{ block.settings.button_label }}</a>
            {%- endif -%}
          </div>
        </div>
      {%- endfor -%}
    </div>

  </div>
</section>

<script>
  (function() {
    const section = document.getElementById('SRV-{{ section.id }}');
    if (!section) return;
    const blocks = section.querySelectorAll('[data-srv-animate]');
    if (!blocks.length) return;

    /* Respect reduced motion */
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      blocks.forEach(b => b.classList.add('is-visible'));
      return;
    }

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          observer.unobserve(entry.target);
        }
      });
    }, {
      threshold: 0.15,
      rootMargin: '0px 0px -50px 0px'
    });

    blocks.forEach(block => observer.observe(block));
  })();
</script>

{% schema %}
{
  "name": "Scroll Reveal",
  "settings": [
    {
      "type": "text",
      "id": "subheading",
      "label": "Subt√≠tulo"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "T√≠tulo"
    },
    {
      "type": "header",
      "content": "üé¨ Animaci√≥n"
    },
    {
      "type": "select",
      "id": "animation_style",
      "label": "Estilo de animaci√≥n",
      "options": [
        { "value": "alternating", "label": "Alternado (izq ‚Üî der)" },
        { "value": "slide-left", "label": "Siempre desde la izquierda" },
        { "value": "slide-right", "label": "Siempre desde la derecha" },
        { "value": "fade-up", "label": "Aparecer desde abajo" }
      ],
      "default": "alternating"
    },
    {
      "type": "range",
      "id": "animation_duration",
      "min": 400,
      "max": 1500,
      "step": 100,
      "unit": "ms",
      "label": "Duraci√≥n de la animaci√≥n",
      "default": 800
    },
    {
      "type": "header",
      "content": "üìê Dise√±o"
    },
    {
      "type": "range",
      "id": "gap",
      "min": 0,
      "max": 80,
      "step": 4,
      "unit": "px",
      "label": "Espacio entre imagen y texto",
      "default": 40
    },
    {
      "type": "range",
      "id": "block_spacing",
      "min": 20,
      "max": 120,
      "step": 10,
      "unit": "px",
      "label": "Espacio entre bloques",
      "default": 60
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Redondeo de imagenes",
      "default": 0
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Ancho completo",
      "default": false
    },
    {
      "type": "header",
      "content": "üé® Colores"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Color de fondo"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Color del texto"
    }
  ],
  "blocks": [
    {
      "type": "block",
      "name": "Bloque",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Imagen"
        },
        {
          "type": "select",
          "id": "image_height",
          "label": "Proporci√≥n de imagen",
          "options": [
            { "value": "auto", "label": "Autom√°tica" },
            { "value": "1/1", "label": "Cuadrada (1:1)" },
            { "value": "3/4", "label": "Vertical (3:4)" },
            { "value": "4/5", "label": "Instagram (4:5)" },
            { "value": "4/3", "label": "Horizontal (4:3)" },
            { "value": "16/9", "label": "Panor√°mica (16:9)" }
          ],
          "default": "auto"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "T√≠tulo",
          "default": "T√≠tulo del bloque"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Texto",
          "default": "<p>Describe algo incre√≠ble sobre tu marca o producto.</p>"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Texto del bot√≥n"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Enlace del bot√≥n"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Scroll Reveal",
      "blocks": [
        { "type": "block", "settings": { "heading": "Dise√±o artesanal" } },
        { "type": "block", "settings": { "heading": "Hecho con amor" } },
        { "type": "block", "settings": { "heading": "Para ti" } }
      ]
    }
  ]
}
{% endschema %}
