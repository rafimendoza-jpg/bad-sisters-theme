{%- comment -%}
  Section: Lookbook ‚Äî Layouts predefinidos que funcionan
  Layout options:
  - 1 columna (full)
  - 2 columnas (50/50)
  - 2 columnas (70/30 o 30/70)
  - 3 columnas iguales
  - Grid masonry (1 grande + 2 chicas)
  Cada imagen tiene tama√±o configurable (aspect ratio), overlay de texto, hotspot
{%- endcomment -%}

{%- assign layout = section.settings.layout -%}

<section class="lbk section-padding" data-section-id="{{ section.id }}"
  style="background: {{ section.settings.bg_color }};">

  <div class="{% if section.settings.full_width %}lbk--full{% else %}page-width{% endif %}">

    {%- if section.settings.heading != blank or section.settings.subheading != blank -%}
      <div class="lbk__header">
        {%- if section.settings.subheading != blank -%}
          <p class="lbk__sub">{{ section.settings.subheading }}</p>
        {%- endif -%}
        {%- if section.settings.heading != blank -%}
          <h2 class="lbk__title">{{ section.settings.heading }}</h2>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="lbk__grid lbk__grid--{{ layout }}" style="gap: {{ section.settings.gap }}px;">
      {%- for block in section.blocks -%}
        {%- assign aspect = block.settings.aspect_ratio -%}
        <div class="lbk__item" {{ block.shopify_attributes }} style="
          {%- if aspect != 'auto' -%}aspect-ratio: {{ aspect }};{%- endif -%}
          border-radius: {{ section.settings.border_radius }}px;
        ">
          {%- comment -%} IMAGE {%- endcomment -%}
          {%- if block.settings.image != blank -%}
            <img
              src="{{ block.settings.image | image_url: width: 1600 }}"
              srcset="{{ block.settings.image | image_url: width: 500 }} 500w, {{ block.settings.image | image_url: width: 800 }} 800w, {{ block.settings.image | image_url: width: 1200 }} 1200w, {{ block.settings.image | image_url: width: 1600 }} 1600w"
              sizes="(max-width: 767px) 100vw, 50vw"
              alt="{{ block.settings.image.alt | default: block.settings.overlay_title | default: 'Lookbook' }}"
              loading="lazy"
              decoding="async"
              width="{{ block.settings.image.width }}"
              height="{{ block.settings.image.height }}"
              class="lbk__img"
              {%- if block.settings.focal_point != 'center center' -%}
                style="object-position: {{ block.settings.focal_point }};"
              {%- endif -%}
            >
          {%- else -%}
            <div class="lbk__placeholder">
              {{ 'lifestyle-2' | placeholder_svg_tag: 'placeholder-svg' }}
            </div>
          {%- endif -%}

          {%- comment -%} HOTSPOT 1 {%- endcomment -%}
          {%- if block.settings.product != blank -%}
            {%- assign hp = block.settings.product -%}
            <div class="lbk__hotspot" style="top: {{ block.settings.tag_y }}%; left: {{ block.settings.tag_x }}%;">
              <button class="lbk__dot" aria-label="Ver {{ hp.title }}" type="button">
                <span class="lbk__dot-ring"></span>
                <span class="lbk__dot-center"></span>
              </button>
              <div class="lbk__card">
                <a href="{{ hp.url }}" class="lbk__card-link">
                  {%- if hp.featured_image -%}
                    <img src="{{ hp.featured_image | image_url: width: 120 }}" alt="{{ hp.title }}" loading="lazy" decoding="async">
                  {%- endif -%}
                  <div class="lbk__card-info">
                    <span class="lbk__card-title">{{ hp.title }}</span>
                    <span class="lbk__card-price">{{ hp.price | money }}</span>
                    <span class="lbk__card-cta">Ver producto ‚Üí</span>
                  </div>
                </a>
              </div>
            </div>
          {%- endif -%}

          {%- comment -%} HOTSPOT 2 {%- endcomment -%}
          {%- if block.settings.product_2 != blank -%}
            {%- assign hp2 = block.settings.product_2 -%}
            <div class="lbk__hotspot" style="top: {{ block.settings.tag_y_2 }}%; left: {{ block.settings.tag_x_2 }}%;">
              <button class="lbk__dot" aria-label="Ver {{ hp2.title }}" type="button">
                <span class="lbk__dot-ring"></span>
                <span class="lbk__dot-center"></span>
              </button>
              <div class="lbk__card">
                <a href="{{ hp2.url }}" class="lbk__card-link">
                  {%- if hp2.featured_image -%}
                    <img src="{{ hp2.featured_image | image_url: width: 120 }}" alt="{{ hp2.title }}" loading="lazy" decoding="async">
                  {%- endif -%}
                  <div class="lbk__card-info">
                    <span class="lbk__card-title">{{ hp2.title }}</span>
                    <span class="lbk__card-price">{{ hp2.price | money }}</span>
                    <span class="lbk__card-cta">Ver producto ‚Üí</span>
                  </div>
                </a>
              </div>
            </div>
          {%- endif -%}

          {%- comment -%} TEXT OVERLAY {%- endcomment -%}
          {%- if block.settings.overlay_title != blank or block.settings.overlay_subtitle != blank -%}
            <div class="lbk__overlay lbk__overlay--{{ block.settings.text_position }}" style="
              --lbk-overlay-opacity: {{ block.settings.overlay_opacity }};
              padding: {{ block.settings.overlay_padding }}px;
            ">
              {%- if block.settings.overlay_title != blank -%}
                <h3 class="lbk__overlay-title" style="font-size: {{ block.settings.title_size }}rem;">
                  {{ block.settings.overlay_title }}
                </h3>
              {%- endif -%}
              {%- if block.settings.overlay_subtitle != blank -%}
                <p class="lbk__overlay-sub">{{ block.settings.overlay_subtitle }}</p>
              {%- endif -%}
              {%- if block.settings.overlay_link_text != blank and block.settings.overlay_link != blank -%}
                <a href="{{ block.settings.overlay_link }}" class="lbk__overlay-btn">
                  {{ block.settings.overlay_link_text }}
                </a>
              {%- endif -%}
            </div>
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>
  </div>
</section>

<script>
  /* Lookbook: hotspot click to show card */
  (function() {
    const section = document.querySelector('[data-section-id="{{ section.id }}"]');
    if (!section) return;
    const dots = section.querySelectorAll('.lbk__dot');
    let activeCard = null;

    dots.forEach(dot => {
      dot.addEventListener('click', (e) => {
        e.stopPropagation();
        const card = dot.parentElement.querySelector('.lbk__card');
        if (activeCard && activeCard !== card) {
          activeCard.classList.remove('is-visible');
        }
        card.classList.toggle('is-visible');
        activeCard = card.classList.contains('is-visible') ? card : null;
      });
    });

    document.addEventListener('click', () => {
      if (activeCard) {
        activeCard.classList.remove('is-visible');
        activeCard = null;
      }
    });
  })();
</script>

{% schema %}
{
  "name": "Lookbook",
  "settings": [
    {
      "type": "text",
      "id": "subheading",
      "label": "Subt√≠tulo"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "T√≠tulo",
      "default": "Lookbook"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "options": [
        { "value": "1-col", "label": "1 columna (ancho completo)" },
        { "value": "2-col", "label": "2 columnas (50/50)" },
        { "value": "2-col-left", "label": "2 columnas (grande izq + chica der)" },
        { "value": "2-col-right", "label": "2 columnas (chica izq + grande der)" },
        { "value": "3-col", "label": "3 columnas iguales" },
        { "value": "masonry", "label": "Masonry (1 grande + 2 chicas apiladas)" }
      ],
      "default": "2-col"
    },
    {
      "type": "range",
      "id": "gap",
      "min": 0,
      "max": 30,
      "step": 1,
      "unit": "px",
      "label": "Espacio entre im√°genes",
      "default": 4
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Redondeo de esquinas",
      "default": 0
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Ancho completo (sin m√°rgenes)",
      "default": true
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Color de fondo",
      "default": "#ffffff"
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Imagen",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Imagen"
        },
        {
          "type": "select",
          "id": "aspect_ratio",
          "label": "Proporci√≥n de la imagen",
          "options": [
            { "value": "auto", "label": "Autom√°tica (tama√±o original)" },
            { "value": "1/1", "label": "Cuadrada (1:1)" },
            { "value": "3/4", "label": "Vertical (3:4)" },
            { "value": "2/3", "label": "Vertical alta (2:3)" },
            { "value": "4/3", "label": "Horizontal (4:3)" },
            { "value": "16/9", "label": "Panor√°mica (16:9)" },
            { "value": "4/5", "label": "Instagram (4:5)" }
          ],
          "default": "auto"
        },
        {
          "type": "select",
          "id": "focal_point",
          "label": "Punto focal",
          "options": [
            { "value": "center center", "label": "Centro" },
            { "value": "top center", "label": "Arriba" },
            { "value": "bottom center", "label": "Abajo" },
            { "value": "left center", "label": "Izquierda" },
            { "value": "right center", "label": "Derecha" }
          ],
          "default": "center center"
        },
        {
          "type": "header",
          "content": "üìç Producto 1"
        },
        {
          "type": "product",
          "id": "product",
          "label": "Producto vinculado"
        },
        {
          "type": "range",
          "id": "tag_x",
          "min": 5,
          "max": 95,
          "step": 1,
          "unit": "%",
          "label": "Posici√≥n horizontal",
          "default": 50
        },
        {
          "type": "range",
          "id": "tag_y",
          "min": 5,
          "max": 95,
          "step": 1,
          "unit": "%",
          "label": "Posici√≥n vertical",
          "default": 40
        },
        {
          "type": "header",
          "content": "üìç Producto 2 (opcional)"
        },
        {
          "type": "product",
          "id": "product_2",
          "label": "Segundo producto"
        },
        {
          "type": "range",
          "id": "tag_x_2",
          "min": 5,
          "max": 95,
          "step": 1,
          "unit": "%",
          "label": "Posici√≥n horizontal",
          "default": 70
        },
        {
          "type": "range",
          "id": "tag_y_2",
          "min": 5,
          "max": 95,
          "step": 1,
          "unit": "%",
          "label": "Posici√≥n vertical",
          "default": 65
        },
        {
          "type": "header",
          "content": "‚úçÔ∏è Texto overlay"
        },
        {
          "type": "text",
          "id": "overlay_title",
          "label": "T√≠tulo"
        },
        {
          "type": "text",
          "id": "overlay_subtitle",
          "label": "Subt√≠tulo"
        },
        {
          "type": "range",
          "id": "title_size",
          "min": 1,
          "max": 4,
          "step": 0.1,
          "label": "Tama√±o del t√≠tulo (rem)",
          "default": 1.5
        },
        {
          "type": "select",
          "id": "text_position",
          "label": "Posici√≥n del texto",
          "options": [
            { "value": "top-left", "label": "Arriba izquierda" },
            { "value": "top-center", "label": "Arriba centro" },
            { "value": "center", "label": "Centro" },
            { "value": "bottom-left", "label": "Abajo izquierda" },
            { "value": "bottom-center", "label": "Abajo centro" },
            { "value": "bottom-right", "label": "Abajo derecha" }
          ],
          "default": "bottom-left"
        },
        {
          "type": "range",
          "id": "overlay_opacity",
          "min": 0,
          "max": 0.8,
          "step": 0.05,
          "label": "Oscurecimiento",
          "default": 0.4
        },
        {
          "type": "range",
          "id": "overlay_padding",
          "min": 10,
          "max": 60,
          "step": 5,
          "unit": "px",
          "label": "Padding del texto",
          "default": 30
        },
        {
          "type": "text",
          "id": "overlay_link_text",
          "label": "Texto del bot√≥n"
        },
        {
          "type": "url",
          "id": "overlay_link",
          "label": "Enlace del bot√≥n"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Lookbook",
      "settings": {
        "layout": "2-col",
        "gap": 4,
        "full_width": true
      },
      "blocks": [
        { "type": "image" },
        { "type": "image" }
      ]
    }
  ]
}
{% endschema %}
