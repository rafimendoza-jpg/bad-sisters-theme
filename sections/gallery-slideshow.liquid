{%- comment -%} Section: Gallery Slideshow — Slider visual a pantalla completa {%- endcomment -%}

<section class="gallery-slideshow gallery-slideshow--{{ section.settings.height }}" data-section-id="{{ section.id }}" data-animate>
  <div class="gallery-slideshow__track" id="GallerySlideshow-{{ section.id }}">
    {%- for block in section.blocks -%}
      <div class="gallery-slideshow__slide{% if forloop.first %} is-active{% endif %}" {{ block.shopify_attributes }}>
        {%- if block.settings.image != blank -%}
          <img
            src="{{ block.settings.image | image_url: width: 1920 }}"
            srcset="{{ block.settings.image | image_url: width: 600 }} 600w, {{ block.settings.image | image_url: width: 1000 }} 1000w, {{ block.settings.image | image_url: width: 1400 }} 1400w, {{ block.settings.image | image_url: width: 1920 }} 1920w"
            sizes="100vw"
            alt="{{ block.settings.image.alt | default: block.settings.heading | default: 'Slide' }}"
            loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
            {% if forloop.first %}fetchpriority="high"{% endif %}
            decoding="async"
            width="{{ block.settings.image.width }}"
            height="{{ block.settings.image.height }}"
            class="gallery-slideshow__image"
          >
        {%- else -%}
          {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
        {%- endif -%}

        {%- if block.settings.heading != blank or block.settings.text != blank -%}
          <div class="gallery-slideshow__content" style="text-align: {{ block.settings.text_position }};">
            {%- if block.settings.heading != blank -%}
              <h2 class="gallery-slideshow__heading">{{ block.settings.heading }}</h2>
            {%- endif -%}
            {%- if block.settings.text != blank -%}
              <p class="gallery-slideshow__text">{{ block.settings.text }}</p>
            {%- endif -%}
            {%- if block.settings.button_label != blank -%}
              <a href="{{ block.settings.button_link | default: '#' }}" class="btn btn--primary" style="background: #fff; color: #1a1a1a; border-color: #fff; margin-top: 1.5rem;">
                {{ block.settings.button_label }}
              </a>
            {%- endif -%}
          </div>
        {%- endif -%}
      </div>
    {%- endfor -%}
  </div>

  {%- if section.blocks.size > 1 -%}
    <div class="gallery-slideshow__controls">
      <button class="gallery-slideshow__arrow gallery-slideshow__arrow--prev" aria-label="Anterior" onclick="slideGallery('{{ section.id }}', -1)">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
      </button>

      <div class="gallery-slideshow__dots">
        {%- for block in section.blocks -%}
          <button class="gallery-slideshow__dot{% if forloop.first %} is-active{% endif %}"
            aria-label="Slide {{ forloop.index }}"
            onclick="goToSlide('{{ section.id }}', {{ forloop.index0 }})"></button>
        {%- endfor -%}
      </div>

      <button class="gallery-slideshow__arrow gallery-slideshow__arrow--next" aria-label="Siguiente" onclick="slideGallery('{{ section.id }}', 1)">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
      </button>
    </div>

    {%- if section.settings.autoplay -%}
      <script>
        (function() {
          let interval = setInterval(() => slideGallery('{{ section.id }}', 1), {{ section.settings.autoplay_speed }}000);
          document.getElementById('GallerySlideshow-{{ section.id }}').closest('.gallery-slideshow').addEventListener('mouseenter', () => clearInterval(interval));
          document.getElementById('GallerySlideshow-{{ section.id }}').closest('.gallery-slideshow').addEventListener('mouseleave', () => {
            interval = setInterval(() => slideGallery('{{ section.id }}', 1), {{ section.settings.autoplay_speed }}000);
          });
        })();
      </script>
    {%- endif -%}
  {%- endif -%}

  {%- if section.settings.show_counter -%}
    <div class="gallery-slideshow__counter">
      <span class="gallery-slideshow__current">01</span>
      <span class="gallery-slideshow__separator">/</span>
      <span class="gallery-slideshow__total">{{ section.blocks.size | prepend: '00' | slice: -2, 2 }}</span>
    </div>
  {%- endif -%}
</section>

<script>
  function slideGallery(sectionId, direction) {
    const track = document.getElementById('GallerySlideshow-' + sectionId);
    const slides = track.querySelectorAll('.gallery-slideshow__slide');
    const dots = track.closest('.gallery-slideshow').querySelectorAll('.gallery-slideshow__dot');
    const counter = track.closest('.gallery-slideshow').querySelector('.gallery-slideshow__current');
    let current = [...slides].findIndex(s => s.classList.contains('is-active'));
    slides[current].classList.remove('is-active');
    if (dots[current]) dots[current].classList.remove('is-active');
    current = (current + direction + slides.length) % slides.length;
    slides[current].classList.add('is-active');
    if (dots[current]) dots[current].classList.add('is-active');
    if (counter) counter.textContent = String(current + 1).padStart(2, '0');
  }

  function goToSlide(sectionId, index) {
    const track = document.getElementById('GallerySlideshow-' + sectionId);
    const slides = track.querySelectorAll('.gallery-slideshow__slide');
    const dots = track.closest('.gallery-slideshow').querySelectorAll('.gallery-slideshow__dot');
    const counter = track.closest('.gallery-slideshow').querySelector('.gallery-slideshow__current');
    slides.forEach(s => s.classList.remove('is-active'));
    dots.forEach(d => d.classList.remove('is-active'));
    slides[index].classList.add('is-active');
    if (dots[index]) dots[index].classList.add('is-active');
    if (counter) counter.textContent = String(index + 1).padStart(2, '0');
  }
</script>

{% schema %}
{
  "name": "Galería slideshow",
  "settings": [
    {
      "type": "select",
      "id": "height",
      "label": "Altura",
      "options": [
        { "value": "small", "label": "Pequeño (50vh)" },
        { "value": "medium", "label": "Mediano (70vh)" },
        { "value": "large", "label": "Grande (85vh)" },
        { "value": "full", "label": "Pantalla completa" }
      ],
      "default": "large"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Reproducción automática",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Velocidad de autoplay",
      "default": 5
    },
    {
      "type": "checkbox",
      "id": "show_counter",
      "label": "Mostrar contador (01/05)",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Imagen"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Título"
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "Texto"
        },
        {
          "type": "select",
          "id": "text_position",
          "label": "Posición del texto",
          "options": [
            { "value": "left", "label": "Izquierda" },
            { "value": "center", "label": "Centro" },
            { "value": "right", "label": "Derecha" }
          ],
          "default": "center"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Texto del botón"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Enlace del botón"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Galería slideshow",
      "blocks": [
        { "type": "slide" },
        { "type": "slide" },
        { "type": "slide" }
      ]
    }
  ]
}
{% endschema %}
