{%- comment -%}
  Section: Multicolumna ‚Äî Layout flexible
  - N√∫mero de columnas (2-6)
  - Proporci√≥n entre columnas (iguales, primera m√°s grande, √∫ltima m√°s grande, personalizado)
  - Separaci√≥n configurable
  - Im√°genes con aspect ratio seleccionable
  - Ancho y alto completo opcionales
{%- endcomment -%}

{%- assign cols = section.settings.columns | default: 3 -%}

<style>
  #MC-{{ section.id }} {
    {%- if section.settings.background_color != blank and section.settings.background_color != 'rgba(0,0,0,0)' -%}
      background-color: {{ section.settings.background_color }};
    {%- endif -%}
  }
  #MC-{{ section.id }} .mc__grid {
    display: grid;
    gap: {{ section.settings.gap }}px;
    {%- case section.settings.column_ratio -%}
      {%- when 'equal' -%}
        grid-template-columns: repeat({{ cols }}, 1fr);
      {%- when 'first-large' -%}
        grid-template-columns: 2fr {% for i in (2..cols) %}1fr {% endfor %};
      {%- when 'last-large' -%}
        grid-template-columns: {% for i in (2..cols) %}1fr {% endfor %}2fr;
      {%- when 'center-large' -%}
        {%- if cols == 3 -%}
          grid-template-columns: 1fr 2fr 1fr;
        {%- elsif cols == 5 -%}
          grid-template-columns: 1fr 1fr 2fr 1fr 1fr;
        {%- else -%}
          grid-template-columns: repeat({{ cols }}, 1fr);
        {%- endif -%}
    {%- endcase -%}
  }
  {%- if section.settings.full_height -%}
    #MC-{{ section.id }} .mc__grid { min-height: {{ section.settings.section_height }}vh; }
    #MC-{{ section.id }} .mc__item { display: flex; flex-direction: column; }
    #MC-{{ section.id }} .mc__img-wrap { flex: 1; }
  {%- endif -%}
  @media (max-width: 768px) {
    #MC-{{ section.id }} .mc__grid {
      grid-template-columns: {% if section.settings.mobile_columns == '1' %}1fr{% else %}1fr 1fr{% endif %} !important;
    }
  }
</style>

<section id="MC-{{ section.id }}" class="mc {% unless section.settings.full_height %}section-padding{% endunless %}" data-section-id="{{ section.id }}" data-animate>
  <div class="{% if section.settings.full_width %}mc--full{% else %}page-width{% endif %}">

    {%- if section.settings.heading != blank or section.settings.subheading != blank -%}
      <div class="mc__header"{% if section.settings.text_color != blank %} style="color: {{ section.settings.text_color }};"{% endif %}>
        {%- if section.settings.subheading != blank -%}
          <p class="mc__sub"{% if section.settings.text_color != blank %} style="color: {{ section.settings.text_color }};"{% endif %}>{{ section.settings.subheading }}</p>
        {%- endif -%}
        {%- if section.settings.heading != blank -%}
          <h2 class="mc__title">{{ section.settings.heading }}</h2>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="mc__grid">
      {%- for block in section.blocks -%}
        <div class="mc__item" style="text-align: {{ section.settings.text_alignment }};" {{ block.shopify_attributes }}>

          {%- if block.settings.image != blank -%}
            <div class="mc__img-wrap" style="
              {%- if section.settings.image_ratio != 'auto' and section.settings.full_height == false -%}
                aspect-ratio: {{ section.settings.image_ratio }};
              {%- endif -%}
              overflow: hidden;
              border-radius: {{ section.settings.image_radius }}px;
            ">
              <img
                src="{{ block.settings.image | image_url: width: 800 }}"
                srcset="{{ block.settings.image | image_url: width: 400 }} 400w, {{ block.settings.image | image_url: width: 600 }} 600w, {{ block.settings.image | image_url: width: 800 }} 800w"
                sizes="(max-width: 767px) 90vw, {{ 100 | divided_by: cols }}vw"
                alt="{{ block.settings.heading | default: block.settings.image.alt | default: 'Imagen' }}"
                loading="lazy"
                decoding="async"
                width="{{ block.settings.image.width }}"
                height="{{ block.settings.image.height }}"
                class="mc__img"
              >
            </div>
          {%- endif -%}

          {%- if block.settings.icon != blank -%}
            <div class="mc__icon">{{ block.settings.icon }}</div>
          {%- endif -%}

          <div class="mc__content"{% if section.settings.text_color != blank %} style="color: {{ section.settings.text_color }};"{% endif %}>
            {%- if block.settings.heading != blank -%}
              <h3 class="mc__heading">{{ block.settings.heading }}</h3>
            {%- endif -%}

            {%- if block.settings.text != blank -%}
              <div class="mc__text rte"{% if section.settings.text_color != blank %} style="color: {{ section.settings.text_color }};"{% endif %}>{{ block.settings.text }}</div>
            {%- endif -%}

            {%- if block.settings.button_label != blank -%}
              <a href="{{ block.settings.button_link | default: '#' }}" class="mc__cta">
                {{ block.settings.button_label }}
              </a>
            {%- endif -%}
          </div>
        </div>
      {%- endfor -%}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Multicolumna",
  "settings": [
    {
      "type": "text",
      "id": "subheading",
      "label": "Subt√≠tulo"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "T√≠tulo",
      "default": "Multicolumna"
    },
    {
      "type": "header",
      "content": "üìê Columnas"
    },
    {
      "type": "range",
      "id": "columns",
      "min": 2,
      "max": 6,
      "step": 1,
      "label": "N√∫mero de columnas",
      "default": 3
    },
    {
      "type": "select",
      "id": "column_ratio",
      "label": "Proporci√≥n de columnas",
      "options": [
        { "value": "equal", "label": "Iguales" },
        { "value": "first-large", "label": "Primera m√°s grande" },
        { "value": "last-large", "label": "√öltima m√°s grande" },
        { "value": "center-large", "label": "Centro m√°s grande (3 o 5 cols)" }
      ],
      "default": "equal"
    },
    {
      "type": "range",
      "id": "gap",
      "min": 0,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Separaci√≥n entre columnas",
      "default": 24
    },
    {
      "type": "select",
      "id": "mobile_columns",
      "label": "Columnas en m√≥vil",
      "options": [
        { "value": "1", "label": "1 columna" },
        { "value": "2", "label": "2 columnas" }
      ],
      "default": "1"
    },
    {
      "type": "header",
      "content": "üñº Im√°genes"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Proporci√≥n de las fotos",
      "options": [
        { "value": "auto", "label": "Autom√°tica (tama√±o original)" },
        { "value": "1/1", "label": "Cuadrada (1:1)" },
        { "value": "3/4", "label": "Vertical (3:4)" },
        { "value": "4/5", "label": "Instagram (4:5)" },
        { "value": "2/3", "label": "Vertical alta (2:3)" },
        { "value": "4/3", "label": "Horizontal (4:3)" },
        { "value": "16/9", "label": "Panor√°mica (16:9)" }
      ],
      "default": "auto"
    },
    {
      "type": "range",
      "id": "image_radius",
      "min": 0,
      "max": 30,
      "step": 1,
      "unit": "px",
      "label": "Redondeo de las fotos",
      "default": 0
    },
    {
      "type": "header",
      "content": "üìè Tama√±o de la secci√≥n"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Ancho completo (sin m√°rgenes)",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "full_height",
      "label": "Alto completo (im√°genes llenan la secci√≥n)",
      "default": false,
      "info": "Las im√°genes se estiran para llenar toda la altura"
    },
    {
      "type": "range",
      "id": "section_height",
      "min": 40,
      "max": 100,
      "step": 5,
      "unit": "vh",
      "label": "Altura de la secci√≥n",
      "default": 70,
      "info": "Solo aplica cuando 'Alto completo' est√° activado"
    },
    {
      "type": "header",
      "content": "üé® Estilo"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Alineaci√≥n del texto",
      "options": [
        { "value": "left", "label": "Izquierda" },
        { "value": "center", "label": "Centro" },
        { "value": "right", "label": "Derecha" }
      ],
      "default": "center"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Color de fondo"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Color del texto"
    }
  ],
  "blocks": [
    {
      "type": "column",
      "name": "Columna",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Imagen"
        },
        {
          "type": "text",
          "id": "icon",
          "label": "Emoji / √çcono",
          "info": "Ejemplo: ‚ú® üñ§ üì¶"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "T√≠tulo",
          "default": "Columna"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Texto",
          "default": "<p>Describe una caracter√≠stica, un beneficio o un paso.</p>"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Texto del bot√≥n"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Enlace del bot√≥n"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Multicolumna",
      "blocks": [
        { "type": "column" },
        { "type": "column" },
        { "type": "column" }
      ]
    }
  ]
}
{% endschema %}
