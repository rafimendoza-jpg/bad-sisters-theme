{%- comment -%}
  Section: Ideas de Looks ‚Äî Carrusel de videos verticales (9:16)
  Estilo Revolve "Beauty Now". Videos subidos directo a Shopify,
  con navegaci√≥n por flechas y bot√≥n CTA.
{%- endcomment -%}

<style>
  #LOOKS-{{ section.id }} {
    {%- if section.settings.background_color != blank and section.settings.background_color != 'rgba(0,0,0,0)' -%}
      background-color: {{ section.settings.background_color }};
    {%- endif -%}
    overflow: hidden;
  }

  /* Header */
  #LOOKS-{{ section.id }} .looks__header {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 2rem;
  }
  #LOOKS-{{ section.id }} .looks__heading {
    font-size: clamp(1.5rem, 3vw, 2.2rem);
    font-weight: 700;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    margin: 0;
    line-height: 1.2;
  }
  #LOOKS-{{ section.id }} .looks__meta {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
  }
  #LOOKS-{{ section.id }} .looks__subheading {
    font-size: 0.9rem;
    color: var(--color-text-light, #666);
    margin: 0;
  }
  #LOOKS-{{ section.id }} .looks__divider {
    width: 1px;
    height: 14px;
    background: var(--color-text-light, #999);
  }
  #LOOKS-{{ section.id }} .looks__view-all {
    font-size: 0.8rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    text-decoration: none;
    color: inherit;
    transition: opacity 0.3s;
  }
  #LOOKS-{{ section.id }} .looks__view-all:hover { opacity: 0.6; }

  /* Track wrapper with arrows */
  #LOOKS-{{ section.id }} .looks__wrapper {
    position: relative;
  }

  /* Arrow buttons */
  #LOOKS-{{ section.id }} .looks__arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 10;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.75);
    border: none;
    color: #fff;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.3s, transform 0.3s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  }
  #LOOKS-{{ section.id }} .looks__arrow:hover {
    background: rgba(0, 0, 0, 0.9);
    transform: translateY(-50%) scale(1.05);
  }
  #LOOKS-{{ section.id }} .looks__arrow:disabled {
    opacity: 0.3;
    cursor: default;
    transform: translateY(-50%);
  }
  #LOOKS-{{ section.id }} .looks__arrow--prev { left: -10px; }
  #LOOKS-{{ section.id }} .looks__arrow--next { right: -10px; }
  #LOOKS-{{ section.id }} .looks__arrow svg {
    width: 18px;
    height: 18px;
  }

  /* Scrollable track */
  #LOOKS-{{ section.id }} .looks__track {
    display: flex;
    gap: {{ section.settings.gap }}px;
    overflow-x: auto;
    scroll-behavior: smooth;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    padding: 0 2px;
  }
  #LOOKS-{{ section.id }} .looks__track::-webkit-scrollbar { display: none; }

  /* Slide */
  #LOOKS-{{ section.id }} .looks__slide {
    flex: 0 0 auto;
    width: {{ section.settings.card_width }}px;
    scroll-snap-align: start;
    position: relative;
    overflow: hidden;
    border-radius: {{ section.settings.border_radius }}px;
    background: #000;
  }

  /* Video container ‚Äî 9:16 */
  #LOOKS-{{ section.id }} .looks__media {
    position: relative;
    aspect-ratio: 9/16;
    overflow: hidden;
    cursor: pointer;
  }
  #LOOKS-{{ section.id }} .looks__video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
  #LOOKS-{{ section.id }} .looks__poster {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 2;
    transition: opacity 0.3s;
  }
  #LOOKS-{{ section.id }} .looks__slide.is-playing .looks__poster {
    opacity: 0;
    pointer-events: none;
  }

  /* Play button overlay */
  #LOOKS-{{ section.id }} .looks__play {
    position: absolute;
    top: 12px;
    right: 12px;
    z-index: 5;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    border: none;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background 0.3s, transform 0.3s;
  }
  #LOOKS-{{ section.id }} .looks__play:hover {
    background: rgba(0, 0, 0, 0.6);
    transform: scale(1.1);
  }
  #LOOKS-{{ section.id }} .looks__play svg { width: 16px; height: 16px; }
  #LOOKS-{{ section.id }} .looks__slide.is-playing .looks__play .looks__play-icon { display: none; }
  #LOOKS-{{ section.id }} .looks__slide.is-playing .looks__play .looks__pause-icon { display: block; }
  #LOOKS-{{ section.id }} .looks__slide:not(.is-playing) .looks__play .looks__pause-icon { display: none; }

  /* Caption bar at bottom */
  #LOOKS-{{ section.id }} .looks__caption {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 5;
    padding: 2rem 1rem 1rem;
    background: linear-gradient(0deg, rgba(0,0,0,0.6) 0%, transparent 100%);
    color: #fff;
  }
  #LOOKS-{{ section.id }} .looks__caption-title {
    font-size: 0.85rem;
    font-weight: 500;
    letter-spacing: 0.03em;
    margin: 0 0 0.25rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  #LOOKS-{{ section.id }} .looks__caption-sub {
    font-size: 0.75rem;
    opacity: 0.8;
    margin: 0;
  }

  /* Hover zoom */
  #LOOKS-{{ section.id }} .looks__slide:hover .looks__video,
  #LOOKS-{{ section.id }} .looks__slide:hover .looks__poster {
    transform: scale(1.02);
    transition: transform 0.5s ease;
  }

  /* Responsive */
  @media (max-width: 768px) {
    #LOOKS-{{ section.id }} .looks__slide {
      width: {{ section.settings.card_width | times: 0.7 | round }}px;
    }
    #LOOKS-{{ section.id }} .looks__arrow { display: none; }
    #LOOKS-{{ section.id }} .looks__header {
      flex-direction: column;
      align-items: flex-start;
    }
  }
  @media (max-width: 480px) {
    #LOOKS-{{ section.id }} .looks__slide {
      width: {{ section.settings.card_width | times: 0.6 | round }}px;
    }
  }
</style>

<section id="LOOKS-{{ section.id }}" class="looks section-padding" data-section-id="{{ section.id }}">
  <div class="page-width">

    {%- comment -%} ---- HEADER ---- {%- endcomment -%}
    <div class="looks__header"{% if section.settings.text_color != blank %} style="color: {{ section.settings.text_color }};"{% endif %}>
      <div>
        {%- if section.settings.heading != blank -%}
          <h2 class="looks__heading">{{ section.settings.heading }}</h2>
        {%- endif -%}
        <div class="looks__meta">
          {%- if section.settings.subheading != blank -%}
            <p class="looks__subheading">{{ section.settings.subheading }}</p>
          {%- endif -%}
          {%- if section.settings.button_label != blank -%}
            {%- if section.settings.subheading != blank -%}
              <span class="looks__divider"></span>
            {%- endif -%}
            <a href="{{ section.settings.button_link | default: '#' }}" class="looks__view-all">{{ section.settings.button_label }}</a>
          {%- endif -%}
        </div>
      </div>
    </div>

    {%- comment -%} ---- CAROUSEL ---- {%- endcomment -%}
    <div class="looks__wrapper">
      <button class="looks__arrow looks__arrow--prev" aria-label="Anterior" data-looks-prev="{{ section.id }}">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
      </button>
      <button class="looks__arrow looks__arrow--next" aria-label="Siguiente" data-looks-next="{{ section.id }}">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 6 15 12 9 18"/></svg>
      </button>

      <div class="looks__track" data-looks-track="{{ section.id }}">
        {%- for block in section.blocks -%}
          <div class="looks__slide" data-looks-slide {{ block.shopify_attributes }}>
            <div class="looks__media" data-looks-media>

              {%- comment -%} VIDEO {%- endcomment -%}
              {%- if block.settings.video != blank -%}
                {{ block.settings.video | video_tag:
                  class: 'looks__video',
                  loop: true,
                  muted: true,
                  playsinline: true,
                  preload: 'metadata',
                  autoplay: false
                }}
              {%- else -%}
                <div class="looks__video" style="width:100%;height:100%;background:#1a1a1a;display:flex;align-items:center;justify-content:center;">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#555" stroke-width="1"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                </div>
              {%- endif -%}

              {%- comment -%} POSTER / THUMBNAIL {%- endcomment -%}
              {%- if block.settings.poster != blank -%}
                <img
                  src="{{ block.settings.poster | image_url: width: 600 }}"
                  srcset="{{ block.settings.poster | image_url: width: 300 }} 300w, {{ block.settings.poster | image_url: width: 600 }} 600w"
                  sizes="(max-width: 480px) 55vw, (max-width: 768px) 40vw, {{ section.settings.card_width }}px"
                  alt="{{ block.settings.caption | default: 'Look' }}"
                  loading="lazy" decoding="async"
                  width="{{ block.settings.poster.width }}"
                  height="{{ block.settings.poster.height }}"
                  class="looks__poster"
                >
              {%- endif -%}

              {%- comment -%} PLAY BUTTON {%- endcomment -%}
              <button class="looks__play" aria-label="Reproducir video" data-looks-play>
                <svg class="looks__play-icon" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                <svg class="looks__pause-icon" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
              </button>

              {%- comment -%} CAPTION {%- endcomment -%}
              {%- if block.settings.caption != blank or block.settings.subtitle != blank -%}
                <div class="looks__caption">
                  {%- if block.settings.caption != blank -%}
                    <p class="looks__caption-title">{{ block.settings.caption }}</p>
                  {%- endif -%}
                  {%- if block.settings.subtitle != blank -%}
                    <p class="looks__caption-sub">{{ block.settings.subtitle }}</p>
                  {%- endif -%}
                </div>
              {%- endif -%}
            </div>

            {%- comment -%} OPTIONAL LINK BELOW {%- endcomment -%}
            {%- if block.settings.link != blank and block.settings.link_text != blank -%}
              <a href="{{ block.settings.link }}" class="looks__slide-cta" style="
                display: block; text-align: center; padding: 0.75rem;
                font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase;
                color: #fff; text-decoration: none; background: rgba(255,255,255,0.08);
                transition: background 0.3s;
              ">{{ block.settings.link_text }}</a>
            {%- endif -%}
          </div>
        {%- endfor -%}
      </div>
    </div>

  </div>
</section>

<script>
  (function() {
    const sectionId = '{{ section.id }}';
    const track = document.querySelector('[data-looks-track="' + sectionId + '"]');
    const prevBtn = document.querySelector('[data-looks-prev="' + sectionId + '"]');
    const nextBtn = document.querySelector('[data-looks-next="' + sectionId + '"]');
    if (!track) return;

    /* --- CAROUSEL NAV --- */
    function getScrollAmount() {
      const slide = track.querySelector('.looks__slide');
      if (!slide) return 300;
      const gap = parseFloat(getComputedStyle(track).gap) || 12;
      return (slide.offsetWidth + gap) * {{ section.settings.scroll_count | default: 3 }};
    }

    function updateArrows() {
      if (!prevBtn || !nextBtn) return;
      prevBtn.disabled = track.scrollLeft <= 5;
      nextBtn.disabled = track.scrollLeft >= track.scrollWidth - track.clientWidth - 5;
    }

    if (prevBtn) prevBtn.addEventListener('click', function() {
      track.scrollBy({ left: -getScrollAmount(), behavior: 'smooth' });
    });
    if (nextBtn) nextBtn.addEventListener('click', function() {
      track.scrollBy({ left: getScrollAmount(), behavior: 'smooth' });
    });

    track.addEventListener('scroll', updateArrows, { passive: true });
    updateArrows();
    window.addEventListener('load', updateArrows);

    /* --- VIDEO PLAY/PAUSE --- */
    const slides = track.querySelectorAll('[data-looks-slide]');
    let currentVideo = null;

    slides.forEach(function(slide) {
      const media = slide.querySelector('[data-looks-media]');
      const video = slide.querySelector('video');
      const playBtn = slide.querySelector('[data-looks-play]');

      function togglePlay() {
        if (!video) return;

        if (slide.classList.contains('is-playing')) {
          video.pause();
          slide.classList.remove('is-playing');
          currentVideo = null;
        } else {
          /* Pause any other playing video */
          if (currentVideo && currentVideo !== slide) {
            var prevVid = currentVideo.querySelector('video');
            if (prevVid) prevVid.pause();
            currentVideo.classList.remove('is-playing');
          }
          video.play();
          slide.classList.add('is-playing');
          currentVideo = slide;
        }
      }

      if (playBtn) playBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        togglePlay();
      });

      if (media) media.addEventListener('click', function() {
        togglePlay();
      });
    });

    /* Pause video when scrolled out of view */
    if ('IntersectionObserver' in window) {
      var videoObserver = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (!entry.isIntersecting) {
            var slide = entry.target;
            var vid = slide.querySelector('video');
            if (vid && slide.classList.contains('is-playing')) {
              vid.pause();
              slide.classList.remove('is-playing');
              if (currentVideo === slide) currentVideo = null;
            }
          }
        });
      }, { threshold: 0.3 });

      slides.forEach(function(slide) { videoObserver.observe(slide); });
    }
  })();
</script>

{% schema %}
{
  "name": "Ideas de Looks",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "T√≠tulo",
      "default": "IDEAS DE LOOKS"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subt√≠tulo",
      "default": "Insp√≠rate con los √∫ltimos looks de @badsistersdesign"
    },
    {
      "type": "header",
      "content": "Bot√≥n"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Texto del bot√≥n",
      "default": "VER TODOS"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Enlace del bot√≥n"
    },
    {
      "type": "header",
      "content": "üìê Dise√±o"
    },
    {
      "type": "range",
      "id": "card_width",
      "min": 200,
      "max": 400,
      "step": 10,
      "unit": "px",
      "label": "Ancho de cada video",
      "default": 300,
      "info": "Se mantiene proporci√≥n 9:16 autom√°ticamente"
    },
    {
      "type": "range",
      "id": "gap",
      "min": 4,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Espacio entre videos",
      "default": 12
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Redondeo de esquinas",
      "default": 4
    },
    {
      "type": "range",
      "id": "scroll_count",
      "min": 1,
      "max": 4,
      "step": 1,
      "label": "Videos por scroll",
      "default": 3,
      "info": "Cu√°ntos videos se desplazan por clic de flecha"
    },
    {
      "type": "header",
      "content": "üé® Colores"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Color de fondo"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Color del texto"
    }
  ],
  "blocks": [
    {
      "type": "look",
      "name": "Video",
      "settings": [
        {
          "type": "video",
          "id": "video",
          "label": "Video",
          "info": "Sube el video directo a Shopify (formato vertical 9:16)"
        },
        {
          "type": "image_picker",
          "id": "poster",
          "label": "Portada del video (opcional)",
          "info": "Se muestra antes de reproducir. Si no la pones, se usa el primer frame."
        },
        {
          "type": "text",
          "id": "caption",
          "label": "Texto sobre el video"
        },
        {
          "type": "text",
          "id": "subtitle",
          "label": "Subt√≠tulo"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Enlace del look"
        },
        {
          "type": "text",
          "id": "link_text",
          "label": "Texto del enlace",
          "info": "Ejemplo: 'Comprar este look'"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Ideas de Looks",
      "settings": {
        "heading": "IDEAS DE LOOKS",
        "subheading": "Insp√≠rate con los √∫ltimos looks de @badsistersdesign",
        "button_label": "VER TODOS"
      },
      "blocks": [
        { "type": "look" },
        { "type": "look" },
        { "type": "look" },
        { "type": "look" },
        { "type": "look" }
      ]
    }
  ]
}
{% endschema %}
