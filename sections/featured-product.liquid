{%- comment -%}
  Section: Producto Destacado
  Muestra un producto seleccionado con galer√≠a de im√°genes y detalles
{%- endcomment -%}

{%- assign product = section.settings.product -%}

<section class="fp section-padding" data-section-id="{{ section.id }}">
  <div class="{% if section.settings.full_width %}fp--full{% else %}page-width{% endif %}">

    {%- if section.settings.heading != blank -%}
      <div class="fp__header">
        <h2 class="fp__heading">{{ section.settings.heading }}</h2>
        {%- if section.settings.subheading != blank -%}
          <p class="fp__subheading">{{ section.settings.subheading }}</p>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="fp__layout fp__layout--{{ section.settings.image_position }}">
      {%- comment -%} ---- IMAGE SIDE ---- {%- endcomment -%}
      <div class="fp__gallery">
        {%- if product != blank -%}
          {%- assign gallery_images = product.images -%}
          {%- if gallery_images.size > 0 -%}
            <div class="fp__main-image-wrap">
              <img
                src="{{ gallery_images[0] | image_url: width: 900 }}"
                srcset="{{ gallery_images[0] | image_url: width: 500 }} 500w, {{ gallery_images[0] | image_url: width: 700 }} 700w, {{ gallery_images[0] | image_url: width: 900 }} 900w"
                sizes="(max-width: 768px) 95vw, 50vw"
                alt="{{ gallery_images[0].alt | default: product.title }}"
                loading="lazy"
                decoding="async"
                width="{{ gallery_images[0].width }}"
                height="{{ gallery_images[0].height }}"
                class="fp__main-img"
                id="FPMainImage-{{ section.id }}"
              >
              {%- if product.compare_at_price > product.price -%}
                <span class="fp__badge">
                  -{{ product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round }}%
                </span>
              {%- endif -%}
            </div>

            {%- if gallery_images.size > 1 -%}
              <div class="fp__thumbs">
                {%- for img in gallery_images limit: 6 -%}
                  <button class="fp__thumb{% if forloop.first %} is-active{% endif %}"
                    data-fp-thumb="{{ section.id }}"
                    data-src="{{ img | image_url: width: 900 }}"
                    data-srcset="{{ img | image_url: width: 500 }} 500w, {{ img | image_url: width: 700 }} 700w, {{ img | image_url: width: 900 }} 900w"
                    data-alt="{{ img.alt | default: product.title }}"
                    aria-label="Ver imagen {{ forloop.index }}">
                    <img
                      src="{{ img | image_url: width: 120 }}"
                      alt="{{ img.alt | default: product.title }}"
                      loading="lazy"
                      decoding="async"
                      width="120"
                      height="160"
                      class="fp__thumb-img"
                    >
                  </button>
                {%- endfor -%}
              </div>
            {%- endif -%}
          {%- else -%}
            <div class="fp__main-image-wrap">
              <div class="fp__placeholder">
                {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
              </div>
            </div>
          {%- endif -%}
        {%- else -%}
          <div class="fp__main-image-wrap">
            <div class="fp__placeholder">
              {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
            </div>
          </div>
        {%- endif -%}
      </div>

      {%- comment -%} ---- DETAILS SIDE ---- {%- endcomment -%}
      <div class="fp__details">
        {%- if product != blank -%}
          {%- if product.vendor != blank and section.settings.show_vendor -%}
            <span class="fp__vendor">{{ product.vendor }}</span>
          {%- endif -%}

          <h3 class="fp__product-title">
            <a href="{{ product.url }}" class="fp__product-link">{{ product.title }}</a>
          </h3>

          <div class="fp__price">
            {%- if product.compare_at_price > product.price -%}
              <s class="fp__price--compare">{{ product.compare_at_price | money }}</s>
              <span class="fp__price--sale">{{ product.price | money }}</span>
            {%- else -%}
              {{ product.price | money }}
            {%- endif -%}
          </div>

          {%- if section.settings.show_description and product.description != blank -%}
            <div class="fp__description">
              {{ product.description | strip_html | truncatewords: section.settings.description_words }}
            </div>
          {%- endif -%}

          {%- comment -%} Custom text from section settings {%- endcomment -%}
          {%- if section.settings.custom_text != blank -%}
            <div class="fp__custom-text">
              {{ section.settings.custom_text }}
            </div>
          {%- endif -%}

          {%- comment -%} Features/highlights from blocks {%- endcomment -%}
          {%- assign feature_blocks = section.blocks | where: 'type', 'feature' -%}
          {%- if feature_blocks.size > 0 -%}
            <ul class="fp__features">
              {%- for block in feature_blocks -%}
                <li class="fp__feature" {{ block.shopify_attributes }}>
                  {%- if block.settings.icon != blank -%}
                    <span class="fp__feature-icon">{{ block.settings.icon }}</span>
                  {%- endif -%}
                  <span class="fp__feature-text">{{ block.settings.text }}</span>
                </li>
              {%- endfor -%}
            </ul>
          {%- endif -%}

          <div class="fp__actions">
            <a href="{{ product.url }}" class="fp__cta">
              {{ section.settings.button_label | default: 'Ver producto' }}
            </a>
          </div>

        {%- else -%}
          <span class="fp__vendor">Marca</span>
          <h3 class="fp__product-title">Producto Destacado</h3>
          <div class="fp__price">$0.00</div>
          <div class="fp__description">Selecciona un producto en la configuraci√≥n de esta secci√≥n para verlo aqu√≠.</div>
          <div class="fp__actions">
            <a href="#" class="fp__cta">Ver producto</a>
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
</section>

<script>
  (function() {
    const sectionId = '{{ section.id }}';
    const thumbs = document.querySelectorAll('[data-fp-thumb="' + sectionId + '"]');
    const mainImg = document.getElementById('FPMainImage-' + sectionId);
    if (!mainImg || thumbs.length === 0) return;

    thumbs.forEach(function(thumb) {
      thumb.addEventListener('click', function() {
        thumbs.forEach(function(t) { t.classList.remove('is-active'); });
        thumb.classList.add('is-active');
        mainImg.src = thumb.dataset.src;
        mainImg.srcset = thumb.dataset.srcset;
        mainImg.alt = thumb.dataset.alt;
      });
    });
  })();
</script>

{% schema %}
{
  "name": "Producto Destacado",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Producto"
    },
    {
      "type": "header",
      "content": "Encabezado"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "T√≠tulo de la secci√≥n",
      "default": "PRODUCTO DESTACADO"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subt√≠tulo"
    },
    {
      "type": "header",
      "content": "Dise√±o"
    },
    {
      "type": "select",
      "id": "image_position",
      "label": "Posici√≥n de la imagen",
      "options": [
        { "value": "left", "label": "Izquierda" },
        { "value": "right", "label": "Derecha" }
      ],
      "default": "left"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Ancho completo",
      "default": false
    },
    {
      "type": "header",
      "content": "Contenido"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Mostrar marca",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "label": "Mostrar descripci√≥n",
      "default": true
    },
    {
      "type": "range",
      "id": "description_words",
      "min": 10,
      "max": 80,
      "step": 5,
      "label": "Palabras de descripci√≥n",
      "default": 35
    },
    {
      "type": "richtext",
      "id": "custom_text",
      "label": "Texto personalizado",
      "info": "Aparece debajo de la descripci√≥n"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Texto del bot√≥n",
      "default": "Ver producto"
    }
  ],
  "blocks": [
    {
      "type": "feature",
      "name": "Detalle / Caracter√≠stica",
      "settings": [
        {
          "type": "text",
          "id": "icon",
          "label": "√çcono (emoji o texto)",
          "info": "Ejemplo: ‚ú¶ o ‚ô° o üåø",
          "default": "‚ú¶"
        },
        {
          "type": "text",
          "id": "text",
          "label": "Texto",
          "default": "Env√≠o gratis"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Producto Destacado",
      "blocks": [
        { "type": "feature", "settings": { "icon": "‚ú¶", "text": "Env√≠o gratis" } },
        { "type": "feature", "settings": { "icon": "‚ô°", "text": "Hecho a mano" } }
      ]
    }
  ]
}
{% endschema %}
